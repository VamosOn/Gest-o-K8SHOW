<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel Roleta - Fibonacci Ficha Atualizado</title>
<style>
:root{--bg:#0f1724;--card:#0b1120;--accent:#ef4444;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
*{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
body{margin:0;background:linear-gradient(180deg,#071029 0%, #081827 100%);color:#e6eef8;padding:24px}
.container{max-width:980px;margin:0 auto}
header{display:flex;align-items:center;gap:16px}
h1{margin:0;font-size:20px}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);margin-top:18px}
.grid{display:grid;gap:12px}
.cols-3{grid-template-columns:1fr 1fr 1fr}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input[type="number"], input[type="text"], select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
.row{display:flex;gap:12px;flex-wrap:wrap}
button{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,#10b981,#06b6d4);color:#042;cursor:pointer;font-weight:600}
.btn-red{background:linear-gradient(90deg,#ef4444,#f97316);color:#fff}
.stat{font-size:14px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
.muted{color:var(--muted)}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.small{font-size:12px;padding:6px 8px;border-radius:8px}
.export{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
.center{display:flex;align-items:center;justify-content:center}
@media (max-width:800px){.cols-3{grid-template-columns:1fr} .row{flex-direction:column}}
</style>
</head>
<body>
<div class="container">
<header>
<h1>Painel de Acompanhamento - Fibonacci (Próxima Entrada)</h1>
<div class="muted">Calcula ganhos considerando o valor da ficha individual e atualiza dinamicamente ao mudar número de apostas ou tipo de aposta.</div>
</header>

<div class="card">
<div class="grid cols-3">
<div><label>Saldo inicial (R$)</label><input id="initialBank" type="number" step="0.01" min="0" value="150" /></div>
<div><label>Valor da Ficha (R$)</label><input id="valorFicha" type="number" step="0.01" min="0.01" value="2" /></div>
<div><label>Qtd. Números Escolhidos</label><input id="qtdNumeros" type="number" step="1" min="1" value="1" /></div>
</div>
<div class="grid cols-3" style="margin-top:12px">
<div><label>Stop Win (% do saldo)</label><input id="stopWinPct" type="number" step="1" min="1" value="20" /></div>
<div><label>Stop Loss (% do saldo)</label><input id="stopLossPct" type="number" step="1" min="1" value="30" /></div>
<div><label>Tipo de aposta</label><select id="betType"><option value="36">Número (36x)</option><option value="3">Dúzia/Coluna (3x)</option><option value="2">Par/Ímpar, Vermelho/Preto (2x)</option></select></div>
</div>
<div class="row" style="margin-top:14px">
<button id="startBtn">Iniciar Sessão</button>
<button id="saveCfg" class="small">Salvar Config</button>
<button id="resetSession" class="small btn-red">Resetar Sessão</button>
<button id="exportCsv" class="small export">Exportar CSV</button>
</div>

<div class="row" style="margin-top:16px">
<div class="card" style="flex:1">
<div class="stat">Saldo Atual: <strong id="currentBank">R$0.00</strong></div>
<div class="muted">Meta (Stop Win): <span id="stopWinVal">R$0.00</span> — Stop Loss: <span id="stopLossVal">R$0.00</span></div>
<div style="margin-top:8px">Lucro Líquido: <span id="sessionProfit" class="muted">R$0.00</span></div>
<div style="margin-top:8px" class="muted">Prêmio da Ficha: <strong id="prizePerFicha">R$0.00</strong></div>
</div>
<div class="card" style="width:320px">
<div class="stat">
  Fibonacci atual: <strong id="fibIndex">0</strong> —
  Próxima entrada: <strong id="nextStake">R$0.00</strong>
</div>
<div class="muted">Stake Atual: <strong id="currentStake">R$0.00</strong></div>
<div style="margin-top:10px" class="controls center">
<button id="btnLose" class="small btn-red">Perdeu</button>
<button id="btnWin" class="small">Ganhou</button>
<button id="undoBtn" class="small">Desfazer</button>
</div>
</div>
</div>

<div class="card">
<h3 style="margin:0;font-size:16px">Histórico de Entradas</h3>
<table id="historyTable"><thead><tr><th>#</th><th>Tipo</th><th>Stake (R$)</th><th>Resultado</th><th>Saldo após</th><th>Hora</th></tr></thead><tbody></tbody></table>
</div>
</div>
<footer style="margin-top:12px;text-align:center;color:var(--muted)">Use em modo demo antes de arriscar dinheiro real. Mantenha disciplina e limites.</footer>

<script>
document.addEventListener('DOMContentLoaded',()=>{
const el=id=>document.getElementById(id);
const fmt=v=>Number(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2});
const fibSeq=[1,1,2,3,5,8,13,21,34,55];
let state={initialBank:150,currentBank:150,fibIndex:0,history:[],valorFicha:2,qtdNumeros:1,betType:36,stopWinPct:20,stopLossPct:30};

function saveCfg(){const cfg={initialBank:Number(el('initialBank').value),valorFicha:Number(el('valorFicha').value),qtdNumeros:Number(el('qtdNumeros').value),stopWinPct:Number(el('stopWinPct').value),stopLossPct:Number(el('stopLossPct').value),betType:Number(el('betType').value)};localStorage.setItem('roleta_panel_cfg',JSON.stringify(cfg));alert('Configurações salvas.')}
function loadCfg(){const s=localStorage.getItem('roleta_panel_cfg');if(s){const c=JSON.parse(s);el('initialBank').value=c.initialBank; el('valorFicha').value=c.valorFicha; el('qtdNumeros').value=c.qtdNumeros; el('stopWinPct').value=c.stopWinPct; el('stopLossPct').value=c.stopLossPct; el('betType').value=c.betType;}}
function saveSession(){localStorage.setItem('roleta_panel_session',JSON.stringify(state));}
function loadSession(){const s=localStorage.getItem('roleta_panel_session');if(s) state=JSON.parse(s); else state.currentBank=Number(el('initialBank').value); updateUI();}
function startSession(){state.initialBank=Number(el('initialBank').value);state.currentBank=state.initialBank; state.fibIndex=0; state.history=[];state.valorFicha=Number(el('valorFicha').value); state.qtdNumeros=Number(el('qtdNumeros').value);state.betType=Number(el('betType').value); state.stopWinPct=Number(el('stopWinPct').value);state.stopLossPct=Number(el('stopLossPct').value); saveSession(); updateUI(); alert('Sessão iniciada!');}

function currentStake(){return state.valorFicha*state.qtdNumeros;}

// atualizar stake e prêmio dinamicamente
el('valorFicha').addEventListener('input',()=>{state.valorFicha=Number(el('valorFicha').value); updateUI();});
el('qtdNumeros').addEventListener('input',()=>{state.qtdNumeros=Number(el('qtdNumeros').value); updateUI();});
el('betType').addEventListener('change',()=>{state.betType=Number(el('betType').value); updateUI();});

function record(result){
  const stake=currentStake();
  const now=new Date();
  if(result==='loss'){
    const totalLoss=stake*fibSeq[Math.min(state.fibIndex,fibSeq.length-1)];
    state.currentBank-=totalLoss;
    state.fibIndex=Math.min(state.fibIndex+1,fibSeq.length-1);
    state.history.push({type:'Entrada',stake:totalLoss,result:'Perdeu',balance:state.currentBank,time:now.toLocaleString()});
  }else{
    const premio=state.valorFicha*state.betType;
    const totalStake=stake*fibSeq[Math.min(state.fibIndex,fibSeq.length-1)];
    const lucro=premio-totalStake;
    state.currentBank+=lucro;
    state.fibIndex=Math.max(0,state.fibIndex-2);
    state.history.push({type:'Entrada',stake:totalStake,result:'Ganhou',balance:state.currentBank,time:now.toLocaleString()});
  }
  saveSession(); updateUI(); checkStops();
}

function updateUI(){
  el('currentBank').textContent='R$'+fmt(state.currentBank);
  el('stopWinVal').textContent='R$'+fmt(state.initialBank*(1+state.stopWinPct/100));
  el('stopLossVal').textContent='R$'+fmt(state.initialBank*(1-state.stopLossPct/100));
  el('fibIndex').textContent=state.fibIndex;
  el('currentStake').textContent='R$'+fmt(currentStake());
  el('prizePerFicha').textContent='R$'+fmt(state.valorFicha*state.betType);
  const nextFib=fibSeq[Math.min(state.fibIndex,fibSeq.length-1)];
  el('nextStake').textContent='R$'+fmt(currentStake()*nextFib);
  const profit=(state.currentBank-state.initialBank).toFixed(2);
  el('sessionProfit').textContent=(profit>=0?'+ ':'-')+'R$'+Math.abs(profit).toFixed(2);

  const tbody=document.querySelector('#historyTable tbody');
  tbody.innerHTML='';
  state.history.forEach((h,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${h.type}</td><td>${fmt(h.stake)}</td><td>${h.result}</td><td>${fmt(h.balance)}</td><td>${h.time}</td>`;
    tbody.appendChild(tr);
  });
}

function checkStops(){
  const winTarget=state.initialBank*(1+state.stopWinPct/100);
  const lossTarget=state.initialBank*(1-state.stopLossPct/100);
  if(state.currentBank>=winTarget){alert('Parabéns — stop win atingido.');}
  if(state.currentBank<=lossTarget){alert('Atenção — stop loss atingido.');}
}

function undo(){
  if(!state.history.length)return alert('Nada para desfazer');
  state.history.pop();
  state.currentBank=state.initialBank; state.fibIndex=0;
  state.history.forEach(h=>{
    if(h.result.includes('Perdeu')){
      state.currentBank-=h.stake;
      state.fibIndex=Math.min(state.fibIndex+1,fibSeq.length-1);
    }else{
      const lucro=state.valorFicha*state.betType-h.stake;
      state.currentBank+=lucro;
      state.fibIndex=Math.max(0,state.fibIndex-2);
    }
  });
  saveSession(); updateUI();
}

function resetSession(){
  if(confirm('Confirma resetar a sessão?')){
    state={
      initialBank:Number(el('initialBank').value),
      currentBank:Number(el('initialBank').value),
      fibIndex:0, history:[], valorFicha:Number(el('valorFicha').value),
      qtdNumeros:Number(el('qtdNumeros').value),
      betType:Number(el('betType').value),
      stopWinPct:Number(el('stopWinPct').value),
      stopLossPct:Number(el('stopLossPct').value)
    };
    const tbody=document.querySelector('#historyTable tbody');
    tbody.innerHTML='';
    saveSession(); updateUI();
  }
}

function exportCsv(){let csv='Nº,Tipo,Stake,Resultado,Saldo,Hora\n'; state.history.forEach((h,i)=>{csv+=`${i+1},${h.type},${h.stake},${h.result},${h.balance},${h.time}\n`;}); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='roleta_historico.csv'; a.click(); URL.revokeObjectURL(url);}

el('startBtn').onclick=startSession;
el('saveCfg').onclick=saveCfg;
el('resetSession').onclick=resetSession;
el('btnLose').onclick=()=>record('loss');
el('btnWin').onclick=()=>record('win');
el('undoBtn').onclick=undo;
el('exportCsv').onclick=exportCsv;

loadCfg(); loadSession();
});
</script>
</body>
</html>
